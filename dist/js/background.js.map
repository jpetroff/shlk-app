{"version":3,"file":"js/background.js","mappings":";;;;;;;;;;;;;;AAAA,iBAAiB,SAAI,IAAI,SAAI;AAC7B,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA,mBAAmB,SAAI,IAAI,SAAI;AAC/B,cAAc,6BAA6B,0BAA0B,cAAc,qBAAqB;AACxG,iBAAiB,oDAAoD,qEAAqE,cAAc;AACxJ,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,mCAAmC,SAAS;AAC5C,mCAAmC,WAAW,UAAU;AACxD,0CAA0C,cAAc;AACxD;AACA,8GAA8G,OAAO;AACrH,iFAAiF,iBAAiB;AAClG,yDAAyD,gBAAgB,QAAQ;AACjF,+CAA+C,gBAAgB,gBAAgB;AAC/E;AACA,kCAAkC;AAClC;AACA;AACA,UAAU,YAAY,aAAa,SAAS,UAAU;AACtD,oCAAoC,SAAS;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,yCAAyC;AAC1G;AACA;AACA;AACA;AACA;AACA;AACA,iCAAiC;AACjC;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iEAAiE,uCAAuC;AACxG;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B,UAAU;AACvC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CAAC;AACD,iEAAe,gBAAgB,EAAC;;;;;;;;;;;;;;;;;;ACrMhC,iBAAiB,SAAI,IAAI,SAAI;AAC7B,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA,mBAAmB,SAAI,IAAI,SAAI;AAC/B,cAAc,6BAA6B,0BAA0B,cAAc,qBAAqB;AACxG,iBAAiB,oDAAoD,qEAAqE,cAAc;AACxJ,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,mCAAmC,SAAS;AAC5C,mCAAmC,WAAW,UAAU;AACxD,0CAA0C,cAAc;AACxD;AACA,8GAA8G,OAAO;AACrH,iFAAiF,iBAAiB;AAClG,yDAAyD,gBAAgB,QAAQ;AACjF,+CAA+C,gBAAgB,gBAAgB;AAC/E;AACA,kCAAkC;AAClC;AACA;AACA,UAAU,YAAY,aAAa,SAAS,UAAU;AACtD,oCAAoC,SAAS;AAC7C;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA,CAAC,kCAAkC;AAC5B;AACP;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA,+BAA+B;AAC/B,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA,kCAAkC;AAClC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA,iEAAe,YAAY,EAAC;;;;;;;;;;;ACxI5B;;AAEA,IAAI,IAA+E;AACnF;AACA;AACA;AACA;AACA;AACA;AACA,EAAE,KAAK;;;;;;UCTP;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;WCtBA;WACA;WACA;WACA;WACA;WACA,iCAAiC,WAAW;WAC5C;WACA;;;;;WCPA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA;;;;;WCPA;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D;;;;;;;;;;;;;;;;ACNA,iBAAiB,SAAI,IAAI,SAAI;AAC7B,4BAA4B,+DAA+D,iBAAiB;AAC5G;AACA,oCAAoC,MAAM,+BAA+B,YAAY;AACrF,mCAAmC,MAAM,mCAAmC,YAAY;AACxF,gCAAgC;AAChC;AACA,KAAK;AACL;AACA,mBAAmB,SAAI,IAAI,SAAI;AAC/B,cAAc,6BAA6B,0BAA0B,cAAc,qBAAqB;AACxG,iBAAiB,oDAAoD,qEAAqE,cAAc;AACxJ,uBAAuB,sBAAsB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;AACxC,mCAAmC,SAAS;AAC5C,mCAAmC,WAAW,UAAU;AACxD,0CAA0C,cAAc;AACxD;AACA,8GAA8G,OAAO;AACrH,iFAAiF,iBAAiB;AAClG,yDAAyD,gBAAgB,QAAQ;AACjF,+CAA+C,gBAAgB,gBAAgB;AAC/E;AACA,kCAAkC;AAClC;AACA;AACA,UAAU,YAAY,aAAa,SAAS,UAAU;AACtD,oCAAoC,SAAS;AAC7C;AACA;AAC8B;AACS;AAC+B;AACtE;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,2DAAiB;AACxE;AACA;AACA;AACA,6BAA6B;AAC7B;AACA,4GAA4G,6EAA6E,8BAA8B,WAAW;AAClO;AACA;AACA;AACA,6BAA6B;AAC7B,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,uDAAuD,2DAAiB;AACxE;AACA;AACA,mDAAmD,qCAAqC,uFAAuF,GAAG,oCAAoC,QAAQ,uBAAuB,WAAW;AAChQ,6BAA6B;AAC7B;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,wEAAoB,uBAAuB,uEAAiB;AACzG;AACA;AACA;AACA,iDAAiD,wEAAoB,aAAa,uEAAiB;AACnG;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,QAAQ,6DAAmB;AAC3B;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,iDAAiD,8DAAoB;AACrE;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,iDAAiD,8DAAoB;AACrE;AACA;AACA;AACA;AACA,+DAA+D,+DAA+D;AAC9H,6CAA6C,4EAAwB;AACrE;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA,6CAA6C,+EAA2B;AACxE;AACA;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,iDAAiD,4EAAwB;AACzE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB,6CAA6C,4EAAwB;AACrE;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA,6CAA6C,+EAA2B;AACxE;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA,gBAAgB,iEAAuB;AACvC;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,iDAAiD,4DAAkB;AACnE;AACA;AACA;AACA;AACA,yDAAyD,cAAc;AACvE;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,6CAA6C,wEAAoB,aAAa,uEAAiB;AAC/F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,yBAAyB;AACzB;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA;AACA;AACA,4BAA4B,uEAA6B;AACzD;AACA;AACA;AACA;AACA;AACA,6BAA6B;AAC7B;AACA,6BAA6B;AAC7B;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,gEAAsB;AACtB,8DAAoB;AACpB,4DAAkB;AAClB,wEAA8B;AAC9B,8DAAoB","sources":["webpack://shlk-main/./src/js/browser.api.ts","webpack://shlk-main/./src/js/proxy-storage.extension.ts","webpack://shlk-main/./src/js/config.js","webpack://shlk-main/webpack/bootstrap","webpack://shlk-main/webpack/runtime/compat get default export","webpack://shlk-main/webpack/runtime/define property getters","webpack://shlk-main/webpack/runtime/hasOwnProperty shorthand","webpack://shlk-main/webpack/runtime/make namespace object","webpack://shlk-main/./src/js/background.ts"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar BrowserApi = /** @class */ (function () {\n    function BrowserApi() {\n        try {\n            if (!chrome) {\n                this.isInit = false;\n            }\n            else {\n                this.isInit = true;\n            }\n        }\n        catch (_a) {\n            this.isInit = false;\n        }\n    }\n    BrowserApi.prototype.getTab = function (active) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tabs, tab;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.isInit)\n                            return [2 /*return*/, null];\n                        return [4 /*yield*/, chrome.tabs.query({ active: active, lastFocusedWindow: true })];\n                    case 1:\n                        tabs = _a.sent();\n                        tab = tabs[0];\n                        if (tab && tab.url) {\n                            return [2 /*return*/, {\n                                    url: tab.url\n                                }];\n                        }\n                        return [2 /*return*/, null];\n                }\n            });\n        });\n    };\n    BrowserApi.prototype.findTab = function (url) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (!this.isInit)\n                    return [2 /*return*/, null];\n                return [2 /*return*/, chrome.tabs.query({\n                        url: url\n                    })];\n            });\n        });\n    };\n    BrowserApi.prototype.closeActiveTab = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var tabs, tab;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!this.isInit)\n                            return [2 /*return*/, null];\n                        return [4 /*yield*/, chrome.tabs.query({ active: true, lastFocusedWindow: true })];\n                    case 1:\n                        tabs = _a.sent();\n                        tab = tabs[0];\n                        return [4 /*yield*/, chrome.tabs.remove(tab.id)];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    BrowserApi.prototype.extensionId = function () {\n        return chrome.runtime.id;\n    };\n    BrowserApi.prototype.sendMessage = function (msg) {\n        return __awaiter(this, void 0, void 0, function () {\n            var response;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, chrome.runtime.reload];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, chrome.runtime.sendMessage(this.extensionId(), msg)];\n                    case 2:\n                        response = _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    BrowserApi.prototype.addListener = function (callback) {\n        return chrome.commands.onCommand.addListener(callback);\n    };\n    BrowserApi.prototype.onMessage = function (callback) {\n        return chrome.runtime.onMessage.addListener(callback);\n    };\n    BrowserApi.prototype.openExternal = function (url) {\n        if (!this.isInit)\n            return;\n        chrome.tabs.create({ url: url });\n    };\n    BrowserApi.prototype.setAlarm = function (name, alarm) {\n        if (!this.isInit)\n            return;\n        chrome.alarms.create(name, alarm);\n    };\n    BrowserApi.prototype.onAlarm = function (callback) {\n        if (!this.isInit)\n            return;\n        chrome.alarms.onAlarm.addListener(callback);\n    };\n    BrowserApi.prototype.onInstalled = function (callback) {\n        if (!this.isInit)\n            return null;\n        chrome.runtime.onInstalled.addListener(callback);\n    };\n    BrowserApi.prototype.onStartup = function (callback) {\n        if (!this.isInit)\n            return void 0;\n        chrome.runtime.onStartup.addListener(callback);\n    };\n    BrowserApi.prototype.getAlarms = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (!this.isInit)\n                    return [2 /*return*/, []];\n                return [2 /*return*/, chrome.alarms.getAll()];\n            });\n        });\n    };\n    BrowserApi.prototype.removeAlarm = function (name) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (!this.isInit)\n                    return [2 /*return*/, void 0];\n                return [2 /*return*/, chrome.alarms.clear(name)];\n            });\n        });\n    };\n    BrowserApi.prototype.removeAllAlarms = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                if (!this.isInit)\n                    return [2 /*return*/, void 0];\n                return [2 /*return*/, chrome.alarms.clearAll()];\n            });\n        });\n    };\n    BrowserApi.prototype.createNotification = function (options, id, callback) {\n        if (!this.isInit)\n            return void 0;\n        if (id) {\n            chrome.notifications.create(id, options, callback);\n        }\n        else {\n            chrome.notifications.create(options, callback);\n        }\n    };\n    BrowserApi.prototype.onNotificationClick = function (callback) {\n        if (!this.isInit)\n            return void 0;\n        chrome.notifications.onClicked.addListener(callback);\n    };\n    return BrowserApi;\n}());\nexport default new BrowserApi();\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nexport var StorageType;\n(function (StorageType) {\n    StorageType[\"local\"] = \"local\";\n    StorageType[\"sync\"] = \"sync\";\n    StorageType[\"session\"] = \"session\";\n    StorageType[\"default\"] = \"\";\n})(StorageType || (StorageType = {}));\nexport var proxyStorage = {\n    getItem: function (key, storage) {\n        if (storage === void 0) { storage = StorageType.sync; }\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, chrome.storage[storage].get(key)];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/, result[key]];\n                }\n            });\n        });\n    },\n    setItem: function (key, value, storage) {\n        if (storage === void 0) { storage = StorageType.sync; }\n        return __awaiter(this, void 0, void 0, function () {\n            var newItem;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        newItem = {};\n                        newItem[key] = value;\n                        return [4 /*yield*/, chrome.storage[storage].set(newItem)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    getAllItems: function (keys, storage) {\n        if (keys === void 0) { keys = []; }\n        if (storage === void 0) { storage = StorageType.sync; }\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, chrome.storage[storage].get(keys)];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    },\n    setAllItems: function (items, storage) {\n        if (storage === void 0) { storage = StorageType.sync; }\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, chrome.storage[storage].set(items)];\n                    case 1:\n                        result = _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    canUse: function () {\n        if (chrome.storage.sync)\n            return true;\n        return false;\n    },\n    removeItem: function (key, storage) {\n        if (storage === void 0) { storage = StorageType.sync; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, chrome.storage[storage].remove(key)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    removeAllItems: function (keys, storage) {\n        if (storage === void 0) { storage = StorageType.sync; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, chrome.storage[storage].remove(keys)];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    }\n};\nexport default proxyStorage;\n","const tmpAddr = 'http://localhost:8002'\n\nif (process.env.NODE_ENV === 'development' && process.env.APP_TARGET == 'extension') {\n  module.exports = {\n    serviceUrl: tmpAddr,\n    displayServiceUrl: 'shlk.cc',\n    target: 'extension',\n    mode: 'development'\n  }\n} else if (process.env.NODE_ENV === 'development' && process.env.APP_TARGET == 'webapp') {\n  module.exports = {\n    serviceUrl: window.location.origin,\n    displayServiceUrl: 'shlk.cc',\n    target: 'webapp',\n    mode: 'development'\n  } \n} else if (process.env.NODE_ENV === 'production' && process.env.APP_TARGET) {\n  module.exports = {\n    serviceUrl: 'https://shlk.cc',\n    displayServiceUrl: 'shlk.cc',\n    mode: 'production',\n    target: process.env.APP_TARGET\n  }\n} else {\n  module.exports = {\n    serviceUrl: 'https://shlk.cc',\n    displayServiceUrl: 'shlk.cc',\n    target: 'webapp',\n    mode: 'production'\n  }\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nimport config from './config';\nimport browserApi from './browser.api';\nimport proxyStorage, { StorageType } from './proxy-storage.extension';\nvar AppNetwork = {\n    updateRestoredTabs: function (ids) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var response, responseBody;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, fetch(config.serviceUrl + '/api', {\n                            method: 'POST',\n                            headers: {\n                                \"Content-Type\": \"application/json\"\n                            },\n                            body: JSON.stringify({\n                                query: \"\\n        mutation (\\n          $ids: String[]\\n        )\\n        {\\n          deleteShortlinkSnoozeTimer(\\n            ids: $ids\\n          ) {\\n            _id\\n          }\\n        }\\n        \",\n                                variables: {\n                                    ids: ids\n                                }\n                            })\n                        })];\n                    case 1:\n                        response = _b.sent();\n                        return [4 /*yield*/, response.json()];\n                    case 2:\n                        responseBody = _b.sent();\n                        return [2 /*return*/, ((_a = responseBody.data) === null || _a === void 0 ? void 0 : _a.deleteShortlinkSnoozeTimer) || ''];\n                }\n            });\n        });\n    },\n    getShortlinks: function (skip) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function () {\n            var response, responseBody;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0: return [4 /*yield*/, fetch(config.serviceUrl + '/api', {\n                            method: 'POST',\n                            body: JSON.stringify({\n                                query: \"\\n        {\\n          getUserShortlinks(args: {isSnooze: true, sort: \\\"snooze.awake\\\", order: \\\"1\\\", limit: 30, skip:\".concat(skip, \"}) {\\n            _id location snooze { awake } siteTitle\\n          } \\n        }\\n        \")\n                            }),\n                            headers: {\n                                \"Content-Type\": \"application/json\"\n                            }\n                        })];\n                    case 1:\n                        response = _b.sent();\n                        if (response.status != 200)\n                            return [2 /*return*/, []];\n                        return [4 /*yield*/, response.json()];\n                    case 2:\n                        responseBody = _b.sent();\n                        return [2 /*return*/, ((_a = responseBody.data) === null || _a === void 0 ? void 0 : _a.getUserShortlinks) || []];\n                }\n            });\n        });\n    }\n};\nvar BackgroundApp = {\n    appState: function (newState) {\n        return __awaiter(this, void 0, void 0, function () {\n            var result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!newState) return [3 /*break*/, 2];\n                        return [4 /*yield*/, proxyStorage.setItem('appState', newState, StorageType.local)];\n                    case 1:\n                        _a.sent();\n                        _a.label = 2;\n                    case 2: return [4 /*yield*/, proxyStorage.getItem('appState', StorageType.local)];\n                    case 3:\n                        result = _a.sent();\n                        console.log('App state ', result);\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    },\n    getSyncOnlineThreshold: function () {\n        var threshold = new Date();\n        threshold.setHours(threshold.getHours() - 1);\n        return threshold.valueOf();\n    },\n    getAwakeSyncThreshold: function () {\n        var threshold = new Date();\n        threshold.setDate(threshold.getDate() + 7);\n        return threshold.valueOf();\n    },\n    getRestoreTimerThreshold: function () {\n        var threshold = new Date();\n        threshold.setMinutes(threshold.getMinutes() + 5);\n        return threshold.valueOf();\n    },\n    setCheckInAlarm: function () {\n        browserApi.setAlarm('checkInTact', {\n            periodInMinutes: 10\n        });\n    },\n    install: function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, BackgroundApp.appState({\n                            isSyncInProgress: false,\n                            lastSynced: BackgroundApp.getSyncOnlineThreshold()\n                        })];\n                    case 1:\n                        _a.sent();\n                        BackgroundApp.setCheckInAlarm();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    startup: function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var alarms;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, browserApi.getAlarms()];\n                    case 1:\n                        alarms = _a.sent();\n                        if (!alarms['checkInTact'])\n                            BackgroundApp.setCheckInAlarm();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    loadSnoozedTabs: function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var snoozedLinks, next, threshold, chunk, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        snoozedLinks = [];\n                        next = true;\n                        threshold = BackgroundApp.getAwakeSyncThreshold();\n                        _a.label = 1;\n                    case 1:\n                        if (!next) return [3 /*break*/, 3];\n                        return [4 /*yield*/, AppNetwork.getShortlinks(snoozedLinks.length)];\n                    case 2:\n                        chunk = _a.sent();\n                        snoozedLinks = Array().concat(snoozedLinks, chunk);\n                        if (chunk.length < 30 || chunk[chunk.length - 1].snooze.awake >= threshold)\n                            next = false;\n                        return [3 /*break*/, 1];\n                    case 3:\n                        result = {};\n                        snoozedLinks.forEach(function (shortlink) {\n                            result[shortlink._id] = shortlink;\n                        });\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    },\n    getExistingAlarms: function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var alarmsArray, result, alarmIDs, shortlinkMetadata;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, browserApi.getAlarms()];\n                    case 1:\n                        alarmsArray = _a.sent();\n                        result = {};\n                        alarmIDs = [];\n                        alarmsArray.forEach(function (alarm) { alarm.name != 'syncSnoozedTabs' && alarmIDs.push(alarm.name); });\n                        return [4 /*yield*/, proxyStorage.getAllItems(alarmIDs)];\n                    case 2:\n                        shortlinkMetadata = (_a.sent());\n                        alarmIDs.forEach(function (id) {\n                            result[id] = shortlinkMetadata[id];\n                        });\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    },\n    updateAlarms: function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var currentState, synced;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, BackgroundApp.appState()];\n                    case 1:\n                        currentState = _a.sent();\n                        console.log(currentState);\n                        return [4 /*yield*/, BackgroundApp.appState({\n                                isSyncInProgress: true,\n                                lastSynced: currentState.lastSynced\n                            })];\n                    case 2:\n                        _a.sent();\n                        return [4 /*yield*/, BackgroundApp.loadSnoozedTabs()];\n                    case 3:\n                        synced = _a.sent();\n                        return [4 /*yield*/, proxyStorage.removeAllItems([])];\n                    case 4:\n                        _a.sent();\n                        BackgroundApp.createAlarms(synced);\n                        return [4 /*yield*/, BackgroundApp.appState({\n                                isSyncInProgress: false,\n                                lastSynced: (new Date()).valueOf()\n                            })];\n                    case 5:\n                        _a.sent();\n                        return [4 /*yield*/, BackgroundApp.restoreSnoozedTabs()];\n                    case 6:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    getAllAlarms: function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var allSyncStorage, keys, result;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, proxyStorage.getAllItems()];\n                    case 1:\n                        allSyncStorage = _a.sent();\n                        keys = Object.getOwnPropertyNames(allSyncStorage);\n                        result = {};\n                        keys.forEach(function (key) {\n                            try {\n                                if (/^link_/.test(key)) {\n                                    var id = (key.split('_'))[1];\n                                    result[id] = allSyncStorage[key];\n                                }\n                            }\n                            catch (_a) { }\n                        });\n                        return [2 /*return*/, result];\n                }\n            });\n        });\n    },\n    createAlarms: function (items) {\n        return __awaiter(this, void 0, void 0, function () {\n            var prefixedItems, keys;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        prefixedItems = {};\n                        keys = Object.getOwnPropertyNames(items);\n                        keys.forEach(function (key) {\n                            prefixedItems[\"link_\".concat(key)] = items[key];\n                        });\n                        return [4 /*yield*/, proxyStorage.setAllItems(prefixedItems)];\n                    case 1:\n                        _a.sent();\n                        console.log('Created ', prefixedItems);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    removeAlarms: function (ids) {\n        return __awaiter(this, void 0, void 0, function () {\n            var prefixedIds;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        prefixedIds = [];\n                        ids.forEach(function (id) {\n                            prefixedIds.push(\"link_\".concat(id));\n                        });\n                        AppNetwork.updateRestoredTabs(ids);\n                        return [4 /*yield*/, proxyStorage.removeAllItems(prefixedIds)];\n                    case 1:\n                        _a.sent();\n                        console.log('Removed ', prefixedIds);\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    openTab: function (url) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                browserApi.openExternal(url);\n                return [2 /*return*/];\n            });\n        });\n    },\n    handleNotificationClick: function (url) {\n        return __awaiter(this, void 0, void 0, function () {\n            var tabs;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, browserApi.findTab(url)];\n                    case 1:\n                        tabs = _a.sent();\n                        if (!tabs[0])\n                            return [2 /*return*/];\n                        chrome.tabs.update(tabs[0].id, { active: true });\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    handleAlarm: function (alarm) {\n        return __awaiter(this, void 0, void 0, function () {\n            var appState;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        if (!(alarm.name == 'checkInAlarm')) return [3 /*break*/, 2];\n                        return [4 /*yield*/, proxyStorage.getItem('appState', StorageType.local)];\n                    case 1:\n                        appState = _a.sent();\n                        if (appState.isSyncInProgess)\n                            return [2 /*return*/];\n                        // check if need sync: last synced is more than 1 hour ago\n                        if (appState.lastSynced < BackgroundApp.getSyncOnlineThreshold()) {\n                            BackgroundApp.updateAlarms();\n                        }\n                        else {\n                            BackgroundApp.restoreSnoozedTabs();\n                        }\n                        _a.label = 2;\n                    case 2: return [2 /*return*/];\n                }\n            });\n        });\n    },\n    restoreSnoozedTabs: function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var existingAlarms, existingAlarmKeys, restoredTabs, awakeTime, restoredTabIDs, title, message;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, BackgroundApp.getAllAlarms()];\n                    case 1:\n                        existingAlarms = _a.sent();\n                        existingAlarmKeys = Object.getOwnPropertyNames(existingAlarms);\n                        restoredTabs = {};\n                        awakeTime = BackgroundApp.getRestoreTimerThreshold();\n                        existingAlarmKeys.forEach(function (id) {\n                            if (existingAlarms[id] && existingAlarms[id].snooze.awake < awakeTime) {\n                                restoredTabs[id] = existingAlarms[id];\n                            }\n                        });\n                        restoredTabIDs = Object.getOwnPropertyNames(restoredTabs);\n                        if (restoredTabIDs.length > 0) {\n                            BackgroundApp.removeAlarms(restoredTabIDs);\n                            restoredTabIDs.forEach(function (id) {\n                                BackgroundApp.openTab(restoredTabs[id].location);\n                            });\n                            title = \"Shlk.cc woke up tabs (\".concat(restoredTabIDs.length, \")\");\n                            message = \"\".concat(restoredTabs[0].siteTitle);\n                            message += restoredTabIDs.length > 1 ? \"and \".concat(restoredTabIDs.length - 1, \" more\") : \"\";\n                            browserApi.createNotification({\n                                type: 'basic',\n                                title: title,\n                                message: message,\n                                iconUrl: '/assets/favicon/android-chrome-192x192.png',\n                                priority: 1\n                            }, restoredTabIDs[0], function (result) {\n                                console.log('Notification: ' + result);\n                            });\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    },\n    handleMessage: function (message, sender, sendResponse) {\n        if (message.command == 'sync')\n            BackgroundApp.updateAlarms();\n        return true;\n    }\n};\nbrowserApi.onInstalled(BackgroundApp.install);\nbrowserApi.onStartup(BackgroundApp.updateAlarms);\nbrowserApi.onAlarm(BackgroundApp.handleAlarm);\nbrowserApi.onNotificationClick(BackgroundApp.handleNotificationClick);\nbrowserApi.onMessage(BackgroundApp.handleMessage);\n"],"names":[],"sourceRoot":""}