(()=>{var t={6914:t=>{t.exports={serviceUrl:"https://shlk.cc",displayServiceUrl:"shlk.cc",target:"webapp",mode:"production",extensionLink:"https://chrome.google.com/webstore/detail/nhmacemlmokklfnncnkncnboajhifepd?hl=en"}}},e={};function n(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=n(6914),e=n.n(t),r=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},o=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};const i=new(function(){function t(){try{chrome?this.isInit=!0:this.isInit=!1}catch(t){this.isInit=!1}}return t.prototype.getTab=function(t){return r(this,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return this.isInit?[4,chrome.tabs.query({active:t,lastFocusedWindow:!0})]:[2,null];case 1:return e=r.sent(),(n=e[0])&&n.url?[2,{url:n.url}]:[2,null]}}))}))},t.prototype.findTab=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){return this.isInit?[2,chrome.tabs.query({url:t})]:[2,null]}))}))},t.prototype.closeActiveTab=function(){return r(this,void 0,void 0,(function(){var t,e;return o(this,(function(n){switch(n.label){case 0:return this.isInit?[4,chrome.tabs.query({active:!0,lastFocusedWindow:!0})]:[2,null];case 1:return t=n.sent(),e=t[0],[4,chrome.tabs.remove(e.id)];case 2:return n.sent(),[2]}}))}))},t.prototype.extensionId=function(){return chrome.runtime.id},t.prototype.sendMessage=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,chrome.runtime.reload];case 1:return e.sent(),[4,chrome.runtime.sendMessage(this.extensionId(),t)];case 2:return e.sent(),[2]}}))}))},t.prototype.addListener=function(t){return chrome.commands.onCommand.addListener(t)},t.prototype.onMessage=function(t){return chrome.runtime.onMessage.addListener(t)},t.prototype.openExternal=function(t){this.isInit&&chrome.tabs.create({url:t})},t.prototype.setAlarm=function(t,e){this.isInit&&chrome.alarms.create(t,e)},t.prototype.onAlarm=function(t){this.isInit&&chrome.alarms.onAlarm.addListener(t)},t.prototype.onInstalled=function(t){if(!this.isInit)return null;chrome.runtime.onInstalled.addListener(t)},t.prototype.onStartup=function(t){this.isInit&&chrome.runtime.onStartup.addListener(t)},t.prototype.getAlarms=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return this.isInit?[2,chrome.alarms.getAll()]:[2,[]]}))}))},t.prototype.removeAlarm=function(t){return r(this,void 0,void 0,(function(){return o(this,(function(e){return this.isInit?[2,chrome.alarms.clear(t)]:[2,void 0]}))}))},t.prototype.removeAllAlarms=function(){return r(this,void 0,void 0,(function(){return o(this,(function(t){return this.isInit?[2,chrome.alarms.clearAll()]:[2,void 0]}))}))},t.prototype.createNotification=function(t,e,n){this.isInit&&(e?chrome.notifications.create(e,t,n):chrome.notifications.create(t,n))},t.prototype.onNotificationClick=function(t){this.isInit&&chrome.notifications.onClicked.addListener(t)},t}());var s,a=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},c=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};!function(t){t.local="local",t.sync="sync",t.session="session",t.default=""}(s||(s={}));const u={getItem:function(t,e){return void 0===e&&(e=s.sync),a(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,chrome.storage[e].get(t)];case 1:return[2,n.sent()[t]]}}))}))},setItem:function(t,e,n){return void 0===n&&(n=s.sync),a(this,void 0,void 0,(function(){var r;return c(this,(function(o){switch(o.label){case 0:return(r={})[t]=e,[4,chrome.storage[n].set(r)];case 1:return o.sent(),[2]}}))}))},getAllItems:function(t,e){return void 0===e&&(e=s.sync),a(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,chrome.storage[e].get(t&&t.length>0?t:void 0)];case 1:return[2,n.sent()]}}))}))},setAllItems:function(t,e){return void 0===e&&(e=s.sync),a(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,chrome.storage[e].set(t)];case 1:return n.sent(),[2]}}))}))},canUse:function(){return!!chrome.storage.sync},removeItem:function(t,e){return void 0===e&&(e=s.sync),a(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return[4,chrome.storage[e].remove(t)];case 1:return n.sent(),[2]}}))}))},removeAllItems:function(t,e){return void 0===e&&(e=s.sync),a(this,void 0,void 0,(function(){return c(this,(function(n){switch(n.label){case 0:return t&&0!=t.length?[3,2]:[4,chrome.storage[e].clear()];case 1:return n.sent(),[3,4];case 2:return[4,chrome.storage[e].remove(t)];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))}};var l=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{c(r.next(t))}catch(t){i(t)}}function a(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}c((r=r.apply(t,e||[])).next())}))},h=function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(s=0)),s;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,r=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==a[0]&&2!==a[0])){s=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){s.label=a[1];break}if(6===a[0]&&s.label<o[1]){s.label=o[1],o=a;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(a);break}o[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}},f="checkInTact",d="production"==e().target?10:1,p={updateRestoredTabs:function(t){var n;return l(this,void 0,void 0,(function(){var r;return h(this,(function(o){switch(o.label){case 0:return[4,fetch(e().serviceUrl+"/api",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:"\n        mutation (\n          $ids: [String]\n        )\n        {\n          deleteShortlinkSnoozeTimer(\n            ids: $ids\n          ) {\n            _id\n          }\n        }\n        ",variables:{ids:t}})})];case 1:return[4,o.sent().json()];case 2:return r=o.sent(),[2,(null===(n=r.data)||void 0===n?void 0:n.deleteShortlinkSnoozeTimer)||""]}}))}))},getShortlinks:function(t){var n;return l(this,void 0,void 0,(function(){var r,o;return h(this,(function(i){switch(i.label){case 0:return[4,fetch(e().serviceUrl+"/api",{method:"POST",body:JSON.stringify({query:'\n        {\n          getUserShortlinks(args: {isSnooze: true, sort: "snooze.awake", order: "1", limit: 30, skip:'.concat(t,"}) {\n            _id location snooze { awake } siteTitle\n          } \n        }\n        ")}),headers:{"Content-Type":"application/json"}})];case 1:return 200!=(r=i.sent()).status?[2,[]]:[4,r.json()];case 2:return o=i.sent(),[2,(null===(n=o.data)||void 0===n?void 0:n.getUserShortlinks)||[]]}}))}))}},v={appState:function(t){return l(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return t?[4,u.setItem("appState",t,s.local)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,u.getItem("appState",s.local)];case 3:return e=n.sent(),console.log("App state ",e),[2,e]}}))}))},getSyncOnlineThreshold:function(){var t=new Date;return t.setHours(t.getHours()-1),t.valueOf()},getAwakeSyncThreshold:function(){var t=new Date;return t.setDate(t.getDate()+7),t.valueOf()},getRestoreTimerThreshold:function(){var t=new Date;return t.setMinutes(t.getMinutes()+5),t.valueOf()},setCheckInAlarm:function(){i.setAlarm(f,{periodInMinutes:d})},install:function(){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,v.appState({isSyncInProgress:!1,lastSynced:v.getSyncOnlineThreshold()})];case 1:return t.sent(),v.setCheckInAlarm(),[2]}}))}))},startup:function(){return l(this,void 0,void 0,(function(){return h(this,(function(t){switch(t.label){case 0:return[4,i.getAlarms()];case 1:return t.sent()[f]||v.setCheckInAlarm(),[2]}}))}))},loadSnoozedTabs:function(){return l(this,void 0,void 0,(function(){var t,e,n,r,o;return h(this,(function(i){switch(i.label){case 0:t=[],e=!0,n=v.getAwakeSyncThreshold(),i.label=1;case 1:return e?[4,p.getShortlinks(t.length)]:[3,3];case 2:return r=i.sent(),t=Array().concat(t,r),(r.length<30||r[r.length-1].snooze.awake>=n)&&(e=!1),[3,1];case 3:return o={},t.forEach((function(t){o[t._id]=t})),[2,o]}}))}))},getExistingAlarms:function(){return l(this,void 0,void 0,(function(){var t,e,n,r;return h(this,(function(o){switch(o.label){case 0:return[4,i.getAlarms()];case 1:return t=o.sent(),e={},n=[],t.forEach((function(t){"syncSnoozedTabs"!=t.name&&n.push(t.name)})),[4,u.getAllItems(n)];case 2:return r=o.sent(),n.forEach((function(t){e[t]=r[t]})),[2,e]}}))}))},updateAlarms:function(){return l(this,void 0,void 0,(function(){var t,e;return h(this,(function(n){switch(n.label){case 0:return[4,v.appState()];case 1:return t=n.sent(),console.log(t),[4,v.appState({isSyncInProgress:!0,lastSynced:t.lastSynced})];case 2:return n.sent(),[4,v.loadSnoozedTabs()];case 3:return e=n.sent(),[4,u.removeAllItems(null)];case 4:return n.sent(),v.createAlarms(e),[4,v.appState({isSyncInProgress:!1,lastSynced:(new Date).valueOf()})];case 5:return n.sent(),[4,v.restoreSnoozedTabs()];case 6:return n.sent(),[2]}}))}))},getAllAlarms:function(){return l(this,void 0,void 0,(function(){var t,e,n;return h(this,(function(r){switch(r.label){case 0:return[4,u.getAllItems(null)];case 1:return t=r.sent(),e=Object.getOwnPropertyNames(t),n={},console.log(t),e.forEach((function(e){try{if(/^link_/.test(e)){var r=e.split("_")[1];n[r]=t[e]}}catch(t){}})),[2,n]}}))}))},createAlarms:function(t){return l(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e={},Object.getOwnPropertyNames(t).forEach((function(n){e["link_".concat(n)]=t[n]})),[4,u.setAllItems(e)];case 1:return n.sent(),console.log("Created ",e),[2]}}))}))},removeAlarms:function(t){return l(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return e=[],t.forEach((function(t){e.push("link_".concat(t))})),p.updateRestoredTabs(t),[4,u.removeAllItems(e)];case 1:return n.sent(),console.log("Removed ",e),[2]}}))}))},openTab:function(t){return l(this,void 0,void 0,(function(){return h(this,(function(e){return i.openExternal(t),[2]}))}))},handleNotificationClick:function(t){return l(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return[4,i.findTab(t)];case 1:return(e=n.sent())[0]?(chrome.tabs.update(e[0].id,{active:!0}),[2]):[2]}}))}))},handleAlarm:function(t){return l(this,void 0,void 0,(function(){var e;return h(this,(function(n){switch(n.label){case 0:return t.name!=f?[3,2]:[4,u.getItem("appState",s.local)];case 1:if((e=n.sent()).isSyncInProgess)return[2];e.lastSynced<v.getSyncOnlineThreshold()?v.updateAlarms():v.restoreSnoozedTabs(),n.label=2;case 2:return[2]}}))}))},restoreSnoozedTabs:function(){return l(this,void 0,void 0,(function(){var t,e,n,r,o,s,a;return h(this,(function(c){switch(c.label){case 0:return[4,v.getAllAlarms()];case 1:return t=c.sent(),e=Object.getOwnPropertyNames(t),console.log(t),n={},r=v.getRestoreTimerThreshold(),e.forEach((function(e){t[e]&&t[e].snooze.awake<r&&(n[e]=t[e])})),console.log(n),(o=Object.getOwnPropertyNames(n)).length>0&&(v.removeAlarms(o),o.forEach((function(t){v.openTab(n[t].location)})),s="Shlk.cc woke up tabs (".concat(o.length,")"),a="".concat(n[o[0]].siteTitle||n[o[0]].location),a+=o.length>1?"and ".concat(o.length-1," more"):"",i.createNotification({type:"basic",title:s,message:a,iconUrl:"/assets/favicon/android-chrome-192x192.png",priority:1},o[0],(function(t){console.log("Notification: "+t)}))),[2]}}))}))},handleMessage:function(t,e,n){return!0}};i.onInstalled(v.install),i.onStartup(v.startup),i.onAlarm(v.handleAlarm),i.onNotificationClick(v.handleNotificationClick),i.onMessage(v.handleMessage)})()})();